# database-engine
 
 c++实现简单关系型数据库

一个页通常由：页头（metadata） + 数据区（record） + 槽目录/slot array（索引记录位置） + 空闲区（free space） + 可选的页尾/校验（checksum）组成。内部页和叶子页在“数据区”内容上不同（children vs values）。

 未完成内容：
 二进制格式：把txt存储改为二进制文件存储
 WAL: 用于保证写入的原子性和崩溃恢复。写操作先追加到日志（顺序写），并在合适时刻将日志内容应用到数据页（checkpoint）。
 映射：把文件 memory-map（映射到虚拟内存）
 数据序列化格式：文档数据库常用 BSON（二进制 JSON）等格式做记录序列化（MongoDB）；关系型通常把列/行编码为紧凑二进制格式或列式存储格式。
 压缩、校验和：生产系统常支持压缩（Snappy、zlib）与校验（CRC）以节省空间并检测损坏。


持久化：页式存储、缓冲池、WAL
删除操作：完整删除算法
性能：所有查找改为二分查找
P1（重要）：
并发控制：读写锁、MVCC
错误处理：异常处理、边界检查
P2（优化）：
变长键支持
批量操作优化
统计信息收集

某些平台访问未对齐数据慢或出错：
磁盘上用紧凑（packed）二进制布局，但程序读磁盘数据时不要直接按成员访问 packed 结构；应把字节拷贝到本地对齐的变量或显式逐字节解析（序列化/反序列化）。这样既兼顾磁盘紧凑，又能避免未对齐的访问



首先需要清楚 页(Page) 和 盘区(Extent) 的概念。页是SQL Server中数据存储的基本单元，每一页的大小都是4K。而盘区是一组页的集合，每一个盘区都是由8个相邻的页组合而成的。